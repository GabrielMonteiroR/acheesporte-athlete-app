<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
    xmlns:sys="clr-namespace:System;assembly=System.Runtime"
    xmlns:viewmodels="clr-namespace:acheesporte_athlete_app.ViewModels"
    x:Class="acheesporte_athlete_app.Views.SelectVenueMapPage"
    x:DataType="viewmodels:SelectVenueMapViewModel"
    BackgroundColor="White">

    <Grid>

        <!-- ROWS -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- BARRA DE BUSCA -->
        <Grid Grid.Row="0" Margin="16,12,16,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="48"/>
            </Grid.ColumnDefinitions>

            <SearchBar x:Name="VenueSearchBar"
                       Placeholder="Buscar locais..."
                       BackgroundColor="White"
                       CancelButtonColor="Gray"
                       FontSize="14"
                       TextColor="Black"
                       Grid.Column="0"
                       TextChanged="OnSearchBarTextChanged"/>

            <Frame Grid.Column="1"
                   Padding="10"
                   CornerRadius="24"
                   BackgroundColor="White"
                   BorderColor="Transparent"
                   HasShadow="False"
                   HeightRequest="48" WidthRequest="48">
                <Image Source="search.png" HeightRequest="24" WidthRequest="24"/>
            </Frame>
        </Grid>

        <!-- MAPA -->
        <maps:Map x:Name="VenueMap"
                  Grid.Row="1"
                  IsShowingUser="True"
                  MapType="Street" />

        <!-- AUTOCOMPLETE -->
        <CollectionView Grid.Row="0"
                        ItemsSource="{Binding Suggestions}"
                        SelectionMode="Single"
                        SelectionChanged="OnSuggestionSelected"
                        Margin="16,64,16,0"
                        BackgroundColor="White"
                        IsVisible="{Binding Suggestions.Count, Converter={StaticResource ZeroToFalseConverter}}">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="12">
                        <Label Text="{Binding Description}" FontSize="14" TextColor="Black"/>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- BOTÃO FILTRO -->
        <Frame Grid.Row="1"
               Padding="12"
               CornerRadius="24"
               BackgroundColor="White"
               BorderColor="Transparent"
               HasShadow="False"
               HeightRequest="58" WidthRequest="58"
               HorizontalOptions="Start"
               VerticalOptions="Start"
               Margin="16">
            <Frame.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnFilterClicked"/>
            </Frame.GestureRecognizers>
            <Image Source="filter.png" HeightRequest="24" WidthRequest="24"/>
        </Frame>

        <!-- LOADER -->
        <ActivityIndicator IsRunning="{Binding IsLoading}"
                           IsVisible="{Binding IsLoading}"
                           Color="Black"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Grid.RowSpan="2"/>

        <!-- MODAL DE FILTRO -->
        <Grid x:Name="FilterModal"
              Grid.RowSpan="2"
              BackgroundColor="#80000000"
              IsVisible="{Binding IsFilterModalVisible}"
              InputTransparent="{Binding IsFilterModalVisible, Converter={StaticResource InverseBoolConverter}}">

            <Frame BackgroundColor="White"
                   CornerRadius="24"
                   Padding="16"
                   Margin="24"
                   WidthRequest="300"
                   HasShadow="True"
                   HorizontalOptions="Center"
                   VerticalOptions="Center">

                <ScrollView>
                    <StackLayout Spacing="16">

                        <Label Text="Filtrar Locais"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="Black"/>

                        <!-- TIPO DE LOCAL -->
                        <Label Text="Tipo de Local" FontSize="14" TextColor="Black"/>
                        <Picker ItemsSource="{Binding VenueTypes}"
                                ItemDisplayBinding="{Binding Name}"
                                SelectedItem="{Binding SelectedVenueType}"
                                Title="Selecione um tipo"
                                TextColor="Black"/>

                        <!-- ESPORTES -->
                        <!-- ▸ Esporte -->
                        <Label Text="Esporte" FontSize="14" TextColor="Black"/>
                        <Picker ItemsSource="{Binding AvailableSports}"
        ItemDisplayBinding="{Binding Name}"
        SelectedItem="{Binding SelectedSport}"
        Title="Selecione um esporte"
        TextColor="Black"/>


                        <!-- DATA -->
                        <Label Text="Data" FontSize="14" TextColor="Black"/>
                        <DatePicker Date="{Binding SelectedDate}"
                                    MinimumDate="{x:Static sys:DateTime.Today}"
                                    TextColor="Black"/>

                        <!-- HORÁRIOS -->
                        <Label Text="Hora de Início" FontSize="14" TextColor="Black"/>
                        <TimePicker Time="{Binding FromTime}" TextColor="Black"/>

                        <Label Text="Hora de Fim" FontSize="14" TextColor="Black"/>
                        <TimePicker Time="{Binding ToTime}" TextColor="Black"/>

                        <!-- BOTÕES -->
                        <Button Text="Aplicar Filtro"
                                Command="{Binding ApplyFilterCommand}"
                                BackgroundColor="#200937"
                                TextColor="White"
                                CornerRadius="12"/>

                        <Button Text="Limpar Filtros"
        Command="{Binding ClearFiltersCommand}"
        BackgroundColor="#e0e0e0"
        TextColor="Black"
        CornerRadius="12"/>


                        <Button Text="Cancelar"
                                Command="{Binding CloseFilterModalCommand}"
                                BackgroundColor="LightGray"
                                TextColor="Black"
                                CornerRadius="12"/>
                    </StackLayout>
                </ScrollView>
            </Frame>
        </Grid>

    </Grid>
</ContentPage>
